<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://xamarin.com/schemas/2014/forms"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="WMS_Movil.ListPendientes"
             BackgroundColor="#f8f9fa">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="*"/>
        </Grid.RowDefinitions>

        <!-- Contenido Principal -->
        <StackLayout Padding="15" Grid.Row="0">
            <!-- Buscador -->
            <Frame BackgroundColor="White" 
                   CornerRadius="10" 
                   Padding="5" 
                   HeightRequest="50"
                   Margin="0,0,0,15">
                <Grid ColumnDefinitions="Auto,*">
                    <Image Source="buscar.png" 
                           HeightRequest="20" 
                           Grid.Column="0"
                           Margin="10,0"/>
                    <Entry x:Name="SearchEntry"
                           Placeholder="Buscar por ID de Pedido"
                           PlaceholderColor="#a0aec0"
                           TextColor="Black"
                           Grid.Column="1"
                           Margin="0,-10,0,-10"
                           VerticalOptions="Center"
                           TextChanged="OnSearchTextChanged"/>
                </Grid>
            </Frame>

            <!-- Lista de pedidos -->
            <CollectionView x:Name="PedidosCollection"
                           SelectionMode="Single"
                           SelectionChanged="OnPedidoSelected">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Frame Margin="0,0,0,10"
                               CornerRadius="10"
                               BackgroundColor="White"
                               HasShadow="True">
                            <Grid RowSpacing="8" Padding="5">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                    <RowDefinition Height="Auto"/>
                                </Grid.RowDefinitions>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"/>
                                    <ColumnDefinition Width="Auto"/>
                                </Grid.ColumnDefinitions>

                                <!-- ID y Fecha -->
                                <StackLayout Grid.Row="0" Grid.Column="0">
                                    <Label Text="{Binding IdPedidos, StringFormat='Pedido #{0}'}"
                                           TextColor="#2d3748"
                                           FontAttributes="Bold"
                                           FontSize="16"/>
                                    <Label Text="{Binding Fecha, StringFormat='{0:dd/MM/yyyy HH:mm}'}"
                                           TextColor="#718096"
                                           FontSize="14"/>
                                </StackLayout>

                                <!-- Nombre Empresa -->
                                <StackLayout Grid.Row="1" Grid.Column="0" 
                                           Orientation="Horizontal" 
                                           Spacing="10">
                                    <Image Source="tienda.png" 
                                           HeightRequest="20"/>
                                    <Label Text="{Binding NombreEmpresa}"
                                           TextColor="#4a5568"
                                           FontSize="15"/>
                                </StackLayout>

                                <!-- Cantidades -->
                                <StackLayout Grid.Row="2" Grid.Column="0" 
                                           Orientation="Horizontal" 
                                           Spacing="15">
                                    <Label Text="{Binding TotalCantidad, StringFormat='Total: {0}'}"
                                           TextColor="#4c51bf"
                                           FontAttributes="Bold"/>
                                    <Label Text="{Binding CantidadLineas, StringFormat='Líneas: {0}'}"
                                           TextColor="#4c51bf"
                                           FontAttributes="Bold"/>
                                </StackLayout>
                            </Grid>
                        </Frame>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </StackLayout>

        <!-- Overlay de Carga -->
        <Grid x:Name="LoadingOverlay" 
              IsVisible="False"
              BackgroundColor="#80000000">
            <Frame BackgroundColor="White"
                   CornerRadius="10"
                   HeightRequest="100"
                   WidthRequest="100"
                   HorizontalOptions="Center"
                   VerticalOptions="Center">
                <StackLayout>
                    <ActivityIndicator x:Name="LoadingIndicator"
                                     IsRunning="True"
                                     Color="#E1251D"
                                     HeightRequest="50"
                                     WidthRequest="50"
                                     HorizontalOptions="Center"
                                     VerticalOptions="Center" />
                    <Label Text="Cargando..."
                           TextColor="#2C3E50"
                           HorizontalOptions="Center"
                           VerticalOptions="Center" />
                </StackLayout>
            </Frame>
        </Grid>
    </Grid>
</ContentPage>